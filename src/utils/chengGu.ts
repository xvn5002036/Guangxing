
// Year Weight (Jia Zi)
// Map of 60 Jia Zi to Weight (in Qian) to avoid float issues, convert to Liang later or store as Float
// Using the data from research (Unit: Liang.Qian)
// We will store as formatted string or number. Let's use number for calculation.
// Map key: GanZhi string (e.g. '甲子')

const YEAR_WEIGHTS: Record<string, number> = {
  "甲子": 1.2, "乙丑": 0.9, "丙寅": 0.6, "丁卯": 0.7, "戊辰": 1.2, "己巳": 0.5,
  "庚午": 0.9, "辛未": 0.8, "壬申": 0.7, "癸酉": 0.8, "甲戌": 1.5, "乙亥": 0.9,
  "丙子": 1.6, "丁丑": 0.8, "戊寅": 0.8, "己卯": 1.9, "庚辰": 1.2, "辛巳": 0.6,
  "壬午": 0.8, "癸未": 0.7, "甲申": 0.5, "乙酉": 1.5, "丙戌": 0.6, "丁亥": 1.6,
  "戊子": 1.5, "己丑": 0.7, "庚寅": 0.9, "辛卯": 1.2, "壬辰": 1.0, "癸巳": 0.7,
  "甲午": 1.5, "乙未": 0.6, "丙申": 0.5, "丁酉": 1.4, "戊戌": 1.4, "己亥": 0.9,
  "庚子": 0.7, "辛丑": 0.7, "壬寅": 0.9, "癸卯": 1.2, "甲辰": 0.8, "乙巳": 0.7,
  "丙午": 1.3, "丁未": 0.5, "戊申": 1.4, "己酉": 0.6, "庚戌": 0.9, "辛亥": 1.7,
  "壬子": 0.5, "癸丑": 0.7, "甲寅": 1.2, "乙卯": 0.8, "丙辰": 0.8, "丁巳": 0.6,
  "戊午": 1.9, "己未": 0.6, "庚申": 0.8, "辛酉": 1.6, "壬戌": 1.0, "癸亥": 0.7
};

const MONTH_WEIGHTS_ARR = [
    0, // placeholder
    0.6, 0.7, 1.8, 0.9, 0.5, 1.6, 0.9, 1.5, 1.8, 0.8, 0.9, 0.5
];

const DAY_WEIGHTS_ARR = [
    0, // placeholder
    0.5, 1.0, 0.8, 1.5, 1.6, 1.5, 0.8, 1.6, 0.8, 1.6, // 1-10
    0.9, 1.7, 0.8, 1.7, 1.0, 0.8, 0.9, 1.8, 0.5, 1.5, // 11-20
    1.0, 0.9, 0.8, 0.9, 1.5, 1.8, 0.7, 0.8, 1.6, 0.6  // 21-30
];

const HOUR_WEIGHTS: Record<string, number> = {
    '子': 1.6, '丑': 0.6, '寅': 0.7, '卯': 1.0,
    '辰': 0.9, '巳': 1.6, '午': 1.0, '未': 0.8,
    '申': 0.8, '酉': 0.9, '戌': 0.6, '亥': 0.6
};

// Map poems (from Article or Standard Text)
// Minimal set from typical source.
const POEMS: Record<string, string> = {
    "2.1": "短命非業謂大空，平生災難事重重；凶禍頻臨陷逆境，終世困苦事不成。",
    "2.2": "身寒骨冷苦伶仃，此命推來行乞人；勞勞碌碌無度日，終年打拱過平生。",
    "2.3": "此命推來骨格輕，求謀作事事難成；妻兒兄弟應難許，別處他鄉作散人。",
    "2.4": "此命推來福祿無，門庭困苦總難榮；六親骨肉皆無靠，流浪他鄉作老翁。",
    "2.5": "此命推來祖業微，門庭營度似稀奇；六親骨肉如冰炭，一世勤勞自把持。",
    "2.6": "平生衣祿苦中求，獨自營謀事不休；離祖出門宜早計，晚來衣祿自無休。",
    "2.7": "一生作事少商量，難靠祖宗作主張；獨馬單槍空做去，早年晚歲總無長。",
    "2.8": "一生行事似飄蓬，祖宗產業在夢中；若不過房改名姓，也當移徒二三通。",
    "2.9": "初年運限未曾亨，縱有功名在後成；須過四旬才可立，移居改姓始為良。",
    "3.0": "勞勞碌碌苦中求，東奔西走何日休；若使終身勤與儉，老來稍可免憂愁。",
    "3.1": "忙忙碌碌苦中求，何日雲開見日頭；難得祖基家可立，中年衣食漸無憂。",
    "3.2": "初年運蹇事難謀，漸有財源如水流；到得中年衣食旺，那時名利一齊收。",
    "3.3": "早年做事事難成，百年勤勞枉費心；半世自如流水去，後來運到始得金。",
    "3.4": "此命福氣果如何，僧道門中衣祿多；離祖出家方為妙，朝晚拜佛念彌陀。",
    "3.5": "生平福量不周全，祖業根基覺少傳；營事生涯宜守舊，時來衣食勝從前。",
    "3.6": "不須勞碌過平生，獨自成家福不輕；早有福星常照命，任君行去百般成。",
    "3.7": "此命般般事不成、弟兄少力自孤行；雖然祖業須微有，來得明時去不明。",
    "3.8": "一身骨肉最清高，早入簧門姓氏標；待到年將三十六，藍衫脫去換紅袍。",
    "3.9": "此命終身運不通，勞勞作事盡皆空；苦心竭力成家計，到得那時在夢中。",
    "4.0": "平生衣祿是綿長，件件心中自主張；前面風霜多受過，後來必定享安康。",
    "4.1": "此命推來自不同，為人能幹異凡庸；中年還有逍遙福，不比前時運來通。",
    "4.2": "得寬懷處且寬懷，何用雙眉皺不開；若使中年命運濟，那時名利一起來。",
    "4.3": "為人心性最聰明，作事軒昂近貴人；衣祿一生天註定，不須勞碌是豐亨。",
    "4.4": "萬事由天莫苦求，須知福碌賴人修；當年財帛難如意，晚景欣然便不優。",
    "4.5": "名利推求竟若何？前番辛苦後奔波；命中難養男和女，骨肉扶持也不多。",
    "4.6": "東西南北盡皆通，出姓移居更覺隆；衣祿無窮無數定，中年晚景一般同。",
    "4.7": "此命推求旺末年，妻榮子貴自怡然；平生原有滔滔福，可卜財源若水泉。",
    "4.8": "初年運道未曾通，幾許蹉跎命亦窮；兄弟六親無依靠，一生事業晚來整。",
    "4.9": "此命推來福不輕，自成自立顯門庭；從來富貴人欽敬，使婢差奴過一生。",
    "5.0": "為利為名終日勞，中年福祿也多遭；老來自有財星照，不比前番目下高。",
    "5.1": "一世榮華事事通，不須勞碌自亨通；兄弟叔侄皆如意，家業成時福祿巨集。",
    "5.2": "一世亨通事事能，不須勞苦自然寧；宗族有光欣喜甚，家產豐盈自稱心。",
    "5.3": "此格推來福澤巨集，興家立業在其中；一生衣食安排定，卻是人間一福翁。",
    "5.4": "此格詳採福澤巨集，詩書滿腹看功成；豐衣足食多安穩，正是人間有福人。",
    "5.5": "策馬揚鞭爭名利，少年作事費籌論；一朝福祿源源至，富貴榮華顯六親。",
    "5.6": "此格推來禮義通，一身福祿用無窮；甜酸苦辣皆嘗過，滾滾財源盈而豐。",
    "5.7": "福祿豐盈萬事全，一身榮耀樂天年；名揚威震人爭羨，此世逍遙宛似仙。",
    "5.8": "平生衣食自然來，名利雙全富貴偕；金榜題名登甲第，紫袍玉帶走金階。",
    "5.9": "細推此格秀而清，必定才高學業成；甲第之中應有分，揚鞭走馬顯威榮。",
    "6.0": "一朝金榜快題名，顯祖榮宗大器成；衣祿定然無欠缺，田園財帛更豐盈。",
    "6.1": "不作朝中金榜客，定為世上大財翁；聰明天付經書熟，名顯高褂自是榮。",
    "6.2": "此命生來福不窮，讀書必定顯親宗；紫衣玉帶為卿相，富貴榮華孰與同。",
    "6.3": "命主為官福祿長，得來富貴實非常；名題雁塔傳金榜，大顯門庭天下揚。",
    "6.4": "此格威權不可當，紫袍金帶塵高堂；榮華富貴誰能及？萬古留名姓氏揚。",
    "6.5": "細推此命福非輕，富貴榮華孰與爭；定國安邦人極品，威聲顯赫震寰瀛。",
    "6.6": "此格人間一福人，堆金積玉滿堂春；從來富貴有天定，金榜題名更顯親。",
    "6.7": "此命生來福自巨集，田園家業最高隆；平生衣祿盈豐足，一路榮華萬事通。",
    "6.8": "富貴由天莫苦求，萬事家計不須謀；十年不比前番事，祖業根基千古留。",
    "6.9": "君是人間福祿星，一生富貴眾人欽；總然衣祿由天定，安享榮華過一生。",
    "7.0": "此命推來福不輕，何須愁慮苦勞心；榮華富貴已天定，正笏垂紳拜紫宸。",
    "7.1": "此命生成大不同，公侯卿相在其中；一生自有逍遙福，富貴榮華極品隆。",
    "7.2": "此命推來天下隆，必定人間一主公。富貴榮華數不盡，定為乾坤一蛟龍。",
    "7.3": "此命推來天下隆，必定人間一主公。富貴榮華數不盡，定為乾坤一蛟龍。"
};

export const getChengGuWeight = (
    yearGanZhi: string,
    lunarMonth: number,
    lunarDay: number,
    timeZhi: string
) => {
    // 1. Year Weight
    const yw = YEAR_WEIGHTS[yearGanZhi] || 0;
    // 2. Month Weight
    const mw = MONTH_WEIGHTS_ARR[lunarMonth] || 0;
    // 3. Day Weight
    const dw = DAY_WEIGHTS_ARR[lunarDay] || 0;
    // 4. Time Weight
    const tw = HOUR_WEIGHTS[timeZhi] || 0;

    // Total
    // Use Math.round to fix float precision (multiply by 10, round, divide by 10)
    let total = yw + mw + dw + tw;
    total = Math.round(total * 10) / 10;
    
    // Format to string X.Y
    const totalStr = total.toFixed(1);
    
    // Poem
    const poem = POEMS[totalStr] || POEMS[(parseFloat(totalStr)).toString()];

    return {
        yearWeight: yw,
        monthWeight: mw,
        dayWeight: dw,
        timeWeight: tw,
        totalWeight: totalStr,
        poem: poem || '暫無詩解'
    };
};
